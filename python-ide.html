<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Python IDE - Neuro-Dev</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1117; 
            color: #f0f6fc; 
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
        }
        
        .navbar {
            background: #161b22;
            padding: 10px 20px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #58a6ff;
        }
        
        .nav-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: #238636;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .btn:hover { background: #2ea043; }
        .btn.secondary { background: #21262d; }
        .btn.secondary:hover { background: #30363d; }
        
        .ide-container {
            display: flex;
            height: calc(100vh - 60px);
        }
        
        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #30363d;
        }
        
        .editor-header {
            background: #161b22;
            padding: 10px 15px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-tab {
            background: #21262d;
            padding: 8px 15px;
            border-radius: 6px 6px 0 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .editor-area {
            flex: 1;
            position: relative;
        }
        
        .editor-wrapper {
            display: flex;
            height: 100%;
        }
        
        .line-numbers {
            background: #161b22;
            color: #7d8590;
            padding: 15px 8px 15px 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            text-align: right;
            border-right: 1px solid #30363d;
            user-select: none;
            min-width: 50px;
            overflow: hidden;
            white-space: pre;
        }
        
        #code-editor {
            flex: 1;
            background: #0d1117;
            color: #f0f6fc;
            border: none;
            outline: none;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            tab-size: 4;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
        
        .output-panel {
            width: 40%;
            display: flex;
            flex-direction: column;
            background: #0d1117;
        }
        
        .output-header {
            background: #161b22;
            padding: 10px 15px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .output-content {
            flex: 1;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-y: scroll;
            overflow-x: hidden;
            white-space: pre-wrap;
            line-height: 1.5;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .input-prompt {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .input-field {
            background: #0d1117;
            border: 1px solid #30363d;
            color: #f0f6fc;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
        }
        
        .status-bar {
            background: #161b22;
            padding: 5px 15px;
            border-top: 1px solid #30363d;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }
        
        .error { color: #f85149; }
        .success { color: #3fb950; }
        .info { color: #58a6ff; }
        .warning { color: #d29922; }
        
        @media (max-width: 768px) {
            .ide-container { flex-direction: column; }
            .output-panel { width: 100%; height: 45%; min-height: 200px; }
            .editor-panel { height: 55%; }
            .nav-actions { gap: 3px; flex-wrap: wrap; }
            .btn { padding: 5px 8px; font-size: 11px; }
            .navbar { padding: 8px 15px; position: sticky; top: 0; z-index: 100; }
            .output-content { 
                padding: 10px; 
                font-size: 12px; 
                overflow-y: scroll !important;
                -webkit-overflow-scrolling: touch !important;
                height: calc(100% - 40px);
                max-height: none;
            }
            #code-editor { padding: 10px; font-size: 12px; }
        }
        
        @media (max-width: 480px) {
            .nav-actions { justify-content: center; }
            .btn { min-width: 60px; }
            .output-panel { height: 50%; }
            .editor-panel { height: 50%; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-logo">
            <i class="fas fa-brain"></i>
            <span>Neuro-Dev Python IDE</span>
        </div>
        <div class="nav-actions">
            <button class="btn secondary" onclick="window.location.href='index.html'">
                <i class="fas fa-home"></i> Home
            </button>
            <button class="btn" onclick="runCode()">
                <i class="fas fa-play"></i> Run
            </button>
            <button class="btn secondary" onclick="saveCode()">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="btn secondary" onclick="loadCode()">
                <i class="fas fa-folder-open"></i> Load
            </button>
            <button class="btn secondary" onclick="clearOutput()">
                <i class="fas fa-trash"></i> Clear
            </button>
            <button class="btn secondary" onclick="loadExample()">
                <i class="fas fa-code"></i> Example
            </button>
        </div>
    </nav>

    <div class="ide-container">
        <div class="editor-panel">
            <div class="editor-header">
                <div class="file-tab">
                    <i class="fab fa-python"></i>
                    main.py
                </div>
                <div style="font-size: 12px; color: #7d8590;">
                    Fast Python IDE - Ready!
                </div>
            </div>
            <div class="editor-area">
                <div class="editor-wrapper">
                    <div class="line-numbers" id="line-numbers">1</div>
                    <textarea id="code-editor" placeholder="# Write your Python code here..."></textarea>
                </div>
            </div>
        </div>
        
        <div class="output-panel">
            <div class="output-header">
                <span><i class="fas fa-terminal"></i> Output</span>
                <span id="status" style="font-size: 12px; color: #7d8590;">Ready</span>
            </div>
            <div class="output-content" id="output">
                <div class="info">üêç Python IDE ready!</div>
                <div class="info">üìù Write code and click Run</div>
                <div class="info">üí° input() function supported</div>
                <div style="margin-top: 10px;">---</div>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <span>Python 3.x | Fast Runtime</span>
        <span id="execution-time"></span>
    </div>
    
    <!-- Google Ad Box -->
    <div style="text-align: center; padding: 20px; background: #111; border-top: 1px solid #333;">
        <div style="color: #666; font-size: 12px; margin-bottom: 10px;">Advertisement</div>
        <div style="max-width: 320px; margin: 0 auto; min-height: 100px; background: #222; border: 1px solid #444; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1916892851128865"
                 data-ad-slot="YOUR_AD_SLOT_ID"
                 data-ad-format="rectangle"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
    </div>

    <script src="https://unpkg.com/skulpt@0.11.1/dist/skulpt.min.js"></script>
    <script src="https://unpkg.com/skulpt@0.11.1/dist/skulpt-stdlib.js"></script>
    <script>
        let isRunning = false;
        const outputDiv = document.getElementById('output');
        const statusSpan = document.getElementById('status');
        const codeEditor = document.getElementById('code-editor');

        // Set simple default code
        const defaultCode = `# Welcome to Python IDE!
# Write your code here and click Run

name = input("Enter your name: ")
print("Hello " + name + "!")

age = int(input("Enter your age: "))
if age >= 18:
    print("You are an adult")
else:
    print("You are young")
    
print("Thanks for using Python IDE!")`;
        
        codeEditor.value = defaultCode;
        updateLineNumbers();

        // Update line numbers
        function updateLineNumbers() {
            const textarea = codeEditor;
            const lineNumbers = document.getElementById('line-numbers');
            const lines = textarea.value.split('\n');
            const lineCount = lines.length;
            
            let numbers = '';
            for (let i = 1; i <= lineCount; i++) {
                numbers += i;
                if (i < lineCount) numbers += '\n';
            }
            lineNumbers.textContent = numbers;
        }
        
        // Add tab support and line numbers
        codeEditor.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;
                this.value = this.value.substring(0, start) + '    ' + this.value.substring(end);
                this.selectionStart = this.selectionEnd = start + 4;
                updateLineNumbers();
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                runCode();
            }
        });
        
        codeEditor.addEventListener('input', updateLineNumbers);
        codeEditor.addEventListener('scroll', function() {
            document.getElementById('line-numbers').scrollTop = this.scrollTop;
        });

        function addOutput(text, type = 'normal') {
            const span = document.createElement('span');
            span.className = type;
            span.textContent = text;
            outputDiv.appendChild(span);
            
            // Aggressive scroll to bottom for mobile
            function forceScroll() {
                outputDiv.scrollTop = outputDiv.scrollHeight;
                outputDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
            
            forceScroll();
            setTimeout(forceScroll, 50);
            setTimeout(forceScroll, 200);
        }

        function clearOutput() {
            outputDiv.innerHTML = '';
            addOutput('Output cleared.\n---\n', 'info');
        }

        function handleInput(prompt) {
            return new Promise((resolve) => {
                const inputDiv = document.createElement('div');
                inputDiv.className = 'input-prompt';
                inputDiv.innerHTML = `
                    <div style="color: #58a6ff;">${prompt}</div>
                    <input type="text" class="input-field" placeholder="Type your input and press Enter..." />
                `;
                
                const input = inputDiv.querySelector('.input-field');
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const value = input.value;
                        addOutput(`${prompt}${value}\n`, 'info');
                        inputDiv.remove();
                        resolve(value);
                    }
                });
                
                outputDiv.appendChild(inputDiv);
                input.focus();
                fixTerminalScroll();
            });
        }

        function runCode() {
            if (isRunning) {
                addOutput('‚ö†Ô∏è Code is already running!\n', 'warning');
                return;
            }

            const code = codeEditor.value.trim();
            if (!code) {
                addOutput('‚ùå No code to run!\n', 'error');
                return;
            }

            isRunning = true;
            statusSpan.textContent = 'Running...';
            const startTime = Date.now();
            
            addOutput(`üöÄ Running code...\n`, 'info');

            // Configure Skulpt
            Sk.pre = "output";
            Sk.configure({
                output: function(text) {
                    addOutput(text, 'normal');
                },
                read: function(x) {
                    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
                        throw "File not found: '" + x + "'";
                    return Sk.builtinFiles["files"][x];
                },
                inputfun: function(prompt) {
                    return handleInput(prompt || "");
                },
                inputfunTakesPrompt: true
            });

            // Sanitize and validate code input
            function sanitizeCode(text) {
                // Basic validation - only allow Python code patterns
                if (text.length > 50000) {
                    throw new Error('Code too long! Maximum 50,000 characters allowed.');
                }
                
                // Remove HTML/JS patterns that shouldn't be in Python code
                const dangerous = [
                    /<script[^>]*>.*?<\/script>/gi,
                    /javascript:/gi,
                    /on\w+\s*=/gi,
                    /<iframe[^>]*>.*?<\/iframe>/gi,
                    /<[^>]*>/g  // Remove any HTML tags
                ];
                
                let sanitized = text;
                dangerous.forEach(pattern => {
                    sanitized = sanitized.replace(pattern, '');
                });
                
                return sanitized.trim();
            }
            
            let sanitizedCode;
            try {
                sanitizedCode = sanitizeCode(code);
            } catch (error) {
                addOutput(`‚ùå ${error.message}\n`, 'error');
                isRunning = false;
                statusSpan.textContent = 'Ready';
                return;
            }
            
            // Run the code with sanitized input
            var promise = Sk.misceval.asyncToPromise(function() {
                return Sk.importMainWithBody("<stdin>", false, sanitizedCode, true);
            });

            promise.then(function(mod) {
                const executionTime = Date.now() - startTime;
                document.getElementById('execution-time').textContent = `Executed in ${executionTime}ms`;
                addOutput(`\n‚úÖ Execution completed in ${executionTime}ms\n`, 'success');
                autoSave(); // Auto-save after successful execution
            }).catch(function(err) {
                let errorMsg = err.toString();
                
                // Extract actual line number from Skulpt error
                const lineMatch = errorMsg.match(/line (\d+)/);
                if (lineMatch) {
                    const actualLine = parseInt(lineMatch[1]);
                    errorMsg = errorMsg.replace(/line \d+/, `line ${actualLine}`);
                }
                
                addOutput(`‚ùå Error: ${errorMsg}\n`, 'error');
                
                // Provide helpful error hints
                if (errorMsg.includes('SyntaxError')) {
                    addOutput('üí° Hint: Check for missing colons, brackets, or indentation\n', 'info');
                } else if (errorMsg.includes('NameError')) {
                    addOutput('üí° Hint: Check variable names and spelling\n', 'info');
                } else if (errorMsg.includes('TypeError')) {
                    addOutput('üí° Hint: Check data types and function arguments\n', 'info');
                }
            }).finally(function() {
                isRunning = false;
                statusSpan.textContent = 'Ready';
                fixTerminalScroll();
            });
        }

        function loadExample() {
            const examples = [
                `# Hello World
name = input("What is your name? ")
print("Hello " + name + "!")
print("Welcome to Python!")

age = int(input("How old are you? "))
print("Next year you will be", age + 1)`,

                `# Simple Calculator
num1 = int(input("Enter first number: "))
num2 = int(input("Enter second number: "))

print("Addition:", num1 + num2)
print("Subtraction:", num1 - num2)
print("Multiplication:", num1 * num2)
if num2 != 0:
    print("Division:", num1 / num2)`,

                `# Age Checker
age = int(input("Enter your age: "))

if age >= 18:
    print("You are an adult")
else:
    print("You are young")
    
if age >= 60:
    print("Senior citizen")
elif age >= 13:
    print("Teenager")
else:
    print("Child")`,

                `# Basic Math
num = int(input("Enter a number: "))
print("Number:", num)
print("Double:", num * 2)
print("Square:", num * num)

if num > 0:
    print("Positive number")
else:
    print("Negative or zero")`
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            codeEditor.value = randomExample;
            updateLineNumbers();
            addOutput(`üé≤ Random example loaded!\n`, 'info');
        }

        // Save code to localStorage
        function saveCode() {
            const code = codeEditor.value;
            const fileName = prompt('Enter file name:', 'my_code.py');
            if (fileName) {
                localStorage.setItem(`neuro_ide_${fileName}`, code);
                addOutput(`üíæ Code saved as ${fileName}\n`, 'success');
            }
        }

        // Load code from localStorage
        function loadCode() {
            const savedFiles = Object.keys(localStorage)
                .filter(key => key.startsWith('neuro_ide_'))
                .map(key => key.replace('neuro_ide_', ''));
            
            if (savedFiles.length === 0) {
                addOutput('üìÅ No saved files found\n', 'warning');
                return;
            }
            
            const fileList = savedFiles.join('\n');
            const fileName = prompt(`Select file to load:\n${fileList}\n\nEnter file name:`);
            
            if (fileName) {
                const code = localStorage.getItem(`neuro_ide_${fileName}`);
                if (code) {
                    codeEditor.value = code;
                    updateLineNumbers();
                    addOutput(`üìÇ Loaded ${fileName}\n`, 'success');
                } else {
                    addOutput(`‚ùå File ${fileName} not found\n`, 'error');
                }
            }
        }

        // Auto-save current code
        function autoSave() {
            const code = codeEditor.value;
            if (code.trim()) {
                localStorage.setItem('neuro_ide_autosave', code);
            }
        }

        // Load auto-saved code on startup
        function loadAutoSave() {
            const autoSaved = localStorage.getItem('neuro_ide_autosave');
            if (autoSaved && !codeEditor.value.trim()) {
                codeEditor.value = autoSaved;
                updateLineNumbers();
                addOutput('üîÑ Auto-saved code restored\n', 'info');
            }
        }

        // Auto-save every 30 seconds
        setInterval(autoSave, 30000);
        
        // Save on code change
        codeEditor.addEventListener('input', function() {
            clearTimeout(this.saveTimeout);
            this.saveTimeout = setTimeout(autoSave, 2000);
        });

        // Enhanced error handling for Skulpt loading
        let skulptLoadAttempts = 0;
        function checkSkulptLoaded() {
            if (typeof Sk !== 'undefined') {
                addOutput('‚úÖ Python runtime loaded!\n', 'success');
                loadAutoSave();
            } else {
                skulptLoadAttempts++;
                if (skulptLoadAttempts < 3) {
                    addOutput(`‚è≥ Loading Python runtime... (${skulptLoadAttempts}/3)\n`, 'warning');
                    setTimeout(checkSkulptLoaded, 2000);
                } else {
                    addOutput('‚ùå Failed to load Python runtime. Please refresh the page.\n', 'error');
                    addOutput('üí° Try: Check internet connection and refresh\n', 'info');
                }
            }
        }

        // Mobile terminal scroll fix
        function fixTerminalScroll() {
            const terminal = outputDiv;
            terminal.scrollTop = terminal.scrollHeight;
            
            // Force terminal to be scrollable on mobile
            if (window.innerWidth <= 768) {
                terminal.style.height = 'auto';
                terminal.style.maxHeight = '100%';
                terminal.style.overflowY = 'scroll';
                terminal.style.webkitOverflowScrolling = 'touch';
                
                // Scroll to bottom multiple times
                requestAnimationFrame(() => {
                    terminal.scrollTop = terminal.scrollHeight;
                    setTimeout(() => {
                        terminal.scrollTop = terminal.scrollHeight;
                    }, 100);
                });
            }
        }
        
        // Add touch scroll handling
        if ('ontouchstart' in window) {
            outputDiv.addEventListener('touchstart', function(e) {
                this.style.webkitOverflowScrolling = 'touch';
            }, { passive: true });
            
            outputDiv.addEventListener('touchmove', function(e) {
                e.stopPropagation();
            }, { passive: true });
        }
        
        // Check Skulpt loading
        window.addEventListener('load', function() {
            setTimeout(checkSkulptLoaded, 1000);
        });
    </script>
</body>
</html>